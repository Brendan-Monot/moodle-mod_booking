define("mod_booking/bookit",["exports","core/ajax","core/templates","core/notification"],(function(_exports,_ajax,_templates,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e2){didErr=!0,err=_e2},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||_unsupportedIterableToArray(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.loadPreBookingPage=_exports.initprepagemodal=_exports.initbookitbutton=void 0,_exports.toggleContinueButton=function(optionid){var show=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,continueButton=document.querySelector(SELECTORS_MODALID+optionid+" "+SELECTORS_CONTINUEBUTTON),bookingButton=document.querySelector(SELECTORS_MODALID+optionid+" "+SELECTORS_BOOKITBUTTON);console.log(bookingButton,optionid,show),continueButton&&disableButton(continueButton,show);bookingButton&&disableButton(bookingButton,show);showBookItButton(optionid,show)},_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification);var currentbookitpage={},totalbookitpages={},SELECTORS_MODALID="#sbPrePageModal",SELECTORS_INMODALDIV=" div.pageContent",SELECTORS_CONTINUEBUTTON="a.continue-button",SELECTORS_BACKBUTTON="a.back-button",SELECTORS_BOOKITBUTTON="div.booking-button-area",SELECTORS_INMODALBUTTON="div.in-modal-button";_exports.initbookitbutton=function(itemid,area){var selector=SELECTORS_BOOKITBUTTON+'[data-itemid="'+itemid+'"][data-area="'+area+'"]',buttons=document.querySelectorAll(selector);console.log(selector,buttons),buttons&&buttons.forEach((function(button){if(!button.dataset.nojs&&(console.log("add click listener ",button),!button.dataset.initialized)){button.dataset.initialized="true";var userid=button.dataset.userid;button.addEventListener("click",(function(e){e.stopPropagation(),console.log("clicked ",e.target),function(itemid,area,userid){_ajax.default.call([{methodname:"mod_booking_bookit",args:{itemid:itemid,area:area,userid:userid},done:function(res){console.log(res);var jsonarray=JSON.parse(res.json),templates=res.template.split(",");document.querySelectorAll(SELECTORS_BOOKITBUTTON+"[data-itemid='"+itemid+"'][data-area='"+area+"']").forEach((function(button){for(;button.firstChild;){button.firstChild.remove()}var arraytoreduce=_toConsumableArray(jsonarray);console.log(templates,arraytoreduce),templates.forEach((function(template){var data=arraytoreduce.shift();if("mod_booking/prepagemodal"!==template||!button.parentElement.classList.contains("in-modal-button")){var _data$data;console.log(template,data,button);var datatorender=null!==(_data$data=data.data)&&void 0!==_data$data?_data$data:data;console.log(datatorender),_templates.default.renderForPromise(template,datatorender).then((function(_ref){var html=_ref.html,js=_ref.js;return _templates.default.appendNodeContents(button,html,js),!0})).catch((function(ex){_notification.default.addNotification({message:"failed rendering "+ex,type:"danger"})}))}}))}))}}])}(itemid,area,userid)}))}}))};function isHidden(el){var style=window.getComputedStyle(el);return"none"===style.display||"hidden"===style.visibility}_exports.initprepagemodal=function(optionid,totalnumberofpages){console.log("initprepagemodal",optionid),currentbookitpage[optionid]=0,totalbookitpages[optionid]=totalnumberofpages,function(optionid,totalnumberofpages,callback){if(totalnumberofpages<1)return;var selector=SELECTORS_MODALID+optionid+SELECTORS_INMODALDIV,element=document.querySelector(selector);if(!element)return;var observer=new MutationObserver((function(){isHidden(element)||callback(optionid)}));for(;null!==element;){if(isHidden(element)){if(element.dataset.observed)return;return observer.observe(element,{attributes:!0}),void(element.dataset.observed=!0)}element=element.parentElement}callback(optionid,totalnumberofpages)}(optionid,totalnumberofpages,loadPreBookingPage),initializeButton(optionid,!0),initializeButton(optionid,!1)};var loadPreBookingPage=function(optionid){for(var selector=SELECTORS_MODALID+optionid+SELECTORS_INMODALDIV,element=document.querySelector(selector);element.firstChild;)element.removeChild(element.firstChild);_ajax.default.call([{methodname:"mod_booking_load_pre_booking_page",args:{optionid:optionid,pagenumber:currentbookitpage[optionid]},done:function(res){var jsonobject=JSON.parse(res.json),templates=res.template.split(","),dataarray=jsonobject,buttontype=res.buttontype;return function(_x,_x2,_x3){_renderTemplatesOnPage.apply(this,arguments)}(templates,dataarray,selector),function(optionid,buttontype){if(console.log(SELECTORS_MODALID+optionid+" "+SELECTORS_INMODALBUTTON),currentbookitpage[optionid]+1<totalbookitpages[optionid]){var element=document.querySelector(SELECTORS_MODALID+optionid+" "+SELECTORS_CONTINUEBUTTON);element&&(element.classList.remove("hidden"),1==buttontype&&element.classList.add("disabled"));var inModalButton=document.querySelector(SELECTORS_MODALID+optionid+" "+SELECTORS_INMODALBUTTON);inModalButton&&inModalButton.classList.add("hidden")}else{var _element=document.querySelector(SELECTORS_MODALID+optionid+" "+SELECTORS_CONTINUEBUTTON);if(_element&&_element.classList.add("hidden"),1==buttontype){var _inModalButton=document.querySelector(SELECTORS_MODALID+optionid+" "+SELECTORS_INMODALBUTTON);_inModalButton&&_inModalButton.classList.add("hidden")}else{var _inModalButton2=document.querySelector(SELECTORS_MODALID+optionid+" "+SELECTORS_INMODALBUTTON);_inModalButton2&&_inModalButton2.classList.remove("hidden")}}if(currentbookitpage[optionid]>0){var _element2=document.querySelector(SELECTORS_MODALID+optionid+" "+SELECTORS_BACKBUTTON);_element2&&(_element2.classList.remove("hidden"),1==buttontype&&_element2.classList.add("disabled"))}else{var _element3=document.querySelector(SELECTORS_MODALID+optionid+" "+SELECTORS_BACKBUTTON);_element3&&_element3.classList.add("hidden")}}(optionid,buttontype),!0},fail:function(err){console.log(err)}}])};function _renderTemplatesOnPage(){return(_renderTemplatesOnPage=_asyncToGenerator(regeneratorRuntime.mark((function _callee(templates,dataarray,selector){var _iterator,_step,_loop,_ret;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:_iterator=_createForOfIteratorHelper(templates),_context2.prev=1,_loop=regeneratorRuntime.mark((function _loop(){var template,data;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(template=_step.value,console.log("i render first this template, ",template),data=dataarray.shift()){_context.next=5;break}return _context.abrupt("return",{v:!0});case 5:return _context.next=7,_templates.default.renderForPromise(template,data.data).then((function(_ref2){var html=_ref2.html,js=_ref2.js;return console.log("no i append this template, ",template),_templates.default.appendNodeContents(selector,html,js),!0})).catch((function(ex){_notification.default.addNotification({message:"failed rendering "+ex,type:"danger"})}));case 7:case"end":return _context.stop()}}),_loop)})),_iterator.s();case 4:if((_step=_iterator.n()).done){_context2.next=11;break}return _context2.delegateYield(_loop(),"t0",6);case 6:if("object"!==_typeof(_ret=_context2.t0)){_context2.next=9;break}return _context2.abrupt("return",_ret.v);case 9:_context2.next=4;break;case 11:_context2.next=16;break;case 13:_context2.prev=13,_context2.t1=_context2.catch(1),_iterator.e(_context2.t1);case 16:return _context2.prev=16,_iterator.f(),_context2.finish(16);case 19:return _context2.abrupt("return",!0);case 20:case"end":return _context2.stop()}}),_callee,null,[[1,13,16,19]])})))).apply(this,arguments)}function showBookItButton(optionid,show){var inModalButton=document.querySelector(SELECTORS_MODALID+optionid+" "+SELECTORS_INMODALBUTTON);currentbookitpage[optionid]+1==totalbookitpages[optionid]&&(show?inModalButton.classList.remove("hidden"):inModalButton.classList.add("hidden"))}function disableButton(element,show){console.log(element,show),null===show&&(show=!!element.classList.contains("disabled")),show?element.classList.remove("disabled"):element.classList.add("disabled")}function initializeButton(optionid,back){var selector="";selector=back?SELECTORS_MODALID+optionid+" "+SELECTORS_BACKBUTTON:SELECTORS_MODALID+optionid+" "+SELECTORS_CONTINUEBUTTON;var element=document.querySelector(selector);element&&!element.dataset.prepageinit&&(element.dataset.prepageinit=!0,element.addEventListener("click",(function(e){e.stopPropagation(),element.classList.contains("hidden")||(back?currentbookitpage[optionid]--:currentbookitpage[optionid]++,loadPreBookingPage(optionid))})))}_exports.loadPreBookingPage=loadPreBookingPage}));

//# sourceMappingURL=bookit.min.js.map