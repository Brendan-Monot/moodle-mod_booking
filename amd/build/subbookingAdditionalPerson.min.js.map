{"version":3,"file":"subbookingAdditionalPerson.min.js","sources":["../src/subbookingAdditionalPerson.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     mod_booking/subbookingAdditionalPerson\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport DynamicForm from 'core_form/dynamicform';\nimport {initbookitbutton} from 'mod_booking/bookit';\nimport {buttoninit} from 'local_shopping_cart/cart';\n\nconst SELECTOR = {\n    MODALID: 'sbPrePageModal_',\n    FORMCONTAINER: '.subbooking-additionalperson-form',\n    MODALBODY: '.modal-body',\n    CONTINUECONTAINER: ' div.prepage-booking-footer .continue-container',\n    CONTINUEBUTTON: ' div.prepage-booking-footer .continue-button',\n    BOOKINGBUTTON: '[data-area=\"subbooking\"][data-itemid=\"',\n};\n\n/**\n * Init function.\n */\nexport async function init() {\n\n    const container = document.querySelector(SELECTOR.FORMCONTAINER);\n\n    const id = container.dataset.id;\n\n    const continuebutton = container.closest(SELECTOR.MODALBODY).querySelector(SELECTOR.CONTINUEBUTTON);\n\n    const dynamicForm = new DynamicForm(container, 'mod_booking\\\\form\\\\subbooking\\\\additionalperson_form');\n\n    // We need to render the dynamic form right away, so we can acutally have all the necessary elements present.\n    await dynamicForm.load({id: id});\n\n    const bookitbutton = container.closest(SELECTOR.MODALBODY).querySelector(SELECTOR.BOOKINGBUTTON + id);\n\n    // eslint-disable-next-line no-console\n    console.log('bookitbutton', SELECTOR.BOOKINGBUTTON + id, bookitbutton);\n\n    dynamicForm.addEventListener(dynamicForm.events.FORM_SUBMITTED, e => {\n        const response = e.detail;\n\n        if (response) {\n\n            // eslint-disable-next-line no-console\n            console.log(response);\n\n            if (bookitbutton) {\n                bookitbutton.dataset.blocked = 'false';\n                bookitbutton.click();\n\n                // eslint-disable-next-line no-console\n                console.log('clicked on bookitbutton');\n            } else {\n                continuebutton.dataset.blocked = 'false';\n                continuebutton.click();\n\n                // eslint-disable-next-line no-console\n                console.log('clicked on continue');\n            }\n            dynamicForm.load({id: id});\n        }\n    });\n\n    dynamicForm.addEventListener('change', e => {\n\n        // eslint-disable-next-line no-console\n        console.log(e);\n\n        if (e.target.classList.contains('custom-select')) {\n            const button = document.querySelector('.subbooking-additionalperson-form [data-no-submit=\"1\"]');\n            dynamicForm.processNoSubmitButton(button);\n        }\n    });\n\n    // This goes on continue button.\n    // It will prevent the action to be triggered.\n    // Unless the form is validated (see above).\n    if (continuebutton) {\n        continuebutton.dataset.blocked = true;\n        continuebutton.addEventListener('click', () => {\n            dynamicForm.submitFormAjax();\n        });\n    }\n\n    // This goes on the bookit button as well as on the shopping cart.\n    // It will prevent the action to be triggered.\n    // Unless the form is validated (see above).\n    if (bookitbutton) {\n        bookitbutton.dataset.blocked = true;\n        bookitbutton.addEventListener('click', () => {\n            dynamicForm.submitFormAjax();\n        });\n    }\n\n    // Only after the Form is loaded, we reinitialze the buttons.\n    try {\n        buttoninit();\n        initbookitbutton();\n    } catch (e) {\n        // eslint-disable-next-line no-console\n        console.log(e);\n    }\n}"],"names":["container","document","querySelector","SELECTOR","id","dataset","continuebutton","closest","dynamicForm","DynamicForm","load","bookitbutton","console","log","addEventListener","events","FORM_SUBMITTED","e","response","detail","blocked","click","target","classList","contains","button","processNoSubmitButton","submitFormAjax"],"mappings":";;;;;kGAuCUA,UAAYC,SAASC,cAAcC,wBAEnCC,GAAKJ,UAAUK,QAAQD,GAEvBE,eAAiBN,UAAUO,QAAQJ,oBAAoBD,cAAcC,yBAErEK,YAAc,IAAIC,qBAAYT,UAAW,8DAGzCQ,YAAYE,KAAK,CAACN,GAAIA,WAEtBO,aAAeX,UAAUO,QAAQJ,oBAAoBD,cAAcC,uBAAyBC,IAGlGQ,QAAQC,IAAI,eAAgBV,uBAAyBC,GAAIO,cAEzDH,YAAYM,iBAAiBN,YAAYO,OAAOC,gBAAgBC,UACtDC,SAAWD,EAAEE,OAEfD,WAGAN,QAAQC,IAAIK,UAERP,cACAA,aAAaN,QAAQe,QAAU,QAC/BT,aAAaU,QAGbT,QAAQC,IAAI,6BAEZP,eAAeD,QAAQe,QAAU,QACjCd,eAAee,QAGfT,QAAQC,IAAI,wBAEhBL,YAAYE,KAAK,CAACN,GAAIA,SAI9BI,YAAYM,iBAAiB,UAAUG,OAGnCL,QAAQC,IAAII,GAERA,EAAEK,OAAOC,UAAUC,SAAS,iBAAkB,OACxCC,OAASxB,SAASC,cAAc,0DACtCM,YAAYkB,sBAAsBD,YAOtCnB,iBACAA,eAAeD,QAAQe,SAAU,EACjCd,eAAeQ,iBAAiB,SAAS,KACrCN,YAAYmB,qBAOhBhB,eACAA,aAAaN,QAAQe,SAAU,EAC/BT,aAAaG,iBAAiB,SAAS,KACnCN,YAAYmB,+EAQlB,MAAOV,GAELL,QAAQC,IAAII,6EA5Fdd,uBAEa,oCAFbA,mBAGS,cAHTA,wBAKc,+CALdA,uBAMa"}