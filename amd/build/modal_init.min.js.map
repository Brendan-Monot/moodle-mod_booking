{"version":3,"sources":["../src/modal_init.js"],"names":["init","optionid","spinners","document","querySelectorAll","querySelector","console","log","length","forEach","spinner","dataset","userid","respondToVisibility","getBookingOptionDescription","callback","element","getElementById","observer","MutationObserver","isHidden","disconnect","parentElement","observed","observe","attributes","el","style","window","getComputedStyle","display","visibility","description","classList","remove","add","Ajax","call","methodname","args","done","res","jsonobject","JSON","parse","content","Templates","renderForPromise","template","then","html","js","appendNodeContents","catch","ex","Notification","addNotification","message","type","fail","err"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_wunderbyte_table\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\n\n/**\n * Gets called from mustache template.\n * @param {int} optionid\n * @param {int} userid\n */\nexport const init = (optionid = null) => {\n    // eslint-disable-next-line no-console\n\n    let spinners = [];\n    if (optionid === null) {\n        spinners = document.querySelectorAll('[id^=bo_modal_spinner]');\n    } else {\n        spinners = [document.querySelector('[id^=bo_modal_spinner_' + optionid + ']')];\n    }\n\n    // eslint-disable-next-line no-console\n    console.log(\"found number of spinners: \" + spinners.length);\n\n    spinners.forEach((spinner) => {\n        const optionid = spinner.dataset.optionid;\n        const userid = spinner.dataset.userid ?? 0;\n\n        // eslint-disable-next-line no-console\n        console.log(\"optionid: \" + optionid + ' userid: ' + userid);\n\n        respondToVisibility(optionid, userid, getBookingOptionDescription);\n    });\n};\n\n/**\n * React on visibility change.\n * @param {int} optionid\n * @param {int} userid\n * @param {function} callback\n */\nfunction respondToVisibility(optionid, userid, callback) {\n    let element = document.getElementById('bo_modal_spinner_' + optionid);\n\n    var observer = new MutationObserver(function() {\n        if (!isHidden(element)) {\n            this.disconnect();\n            callback(optionid, userid);\n        }\n    });\n\n    // We look if we find a hidden parent. If not, we load right away.\n    while (element !== null) {\n        if (!isHidden(element)) {\n            element = element.parentElement;\n        } else {\n            if (element.dataset.observed) {\n                // eslint-disable-next-line no-console\n                console.log('element already observed ', element);\n                return;\n            }\n\n            observer.observe(element, {attributes: true});\n            // eslint-disable-next-line no-console\n            console.log('set data to observed ', element);\n            element.dataset.observed = true;\n            return;\n        }\n    }\n    callback(optionid, userid);\n}\n\n/**\n * Function to check visibility of element.\n * @param {*} el\n * @returns {boolean}\n */\nfunction isHidden(el) {\n    var style = window.getComputedStyle(el);\n    return ((style.display === 'none') || (style.visibility === 'hidden'));\n}\n\n/**\n * Reloads the rendered table and sets it to the div with the right identifier.\n * @param {int} optionid\n * @param {int} userid\n */\nexport const getBookingOptionDescription = (\n    optionid,\n    userid) => {\n    // eslint-disable-next-line no-console\n    console.log('getBookingOptionDescription ' + optionid);\n\n    let description = document.getElementById('bo_modal_description_' + optionid);\n    let spinner = document.querySelector('#bo_modal_spinner_' + optionid + ' .spinner-border');\n\n    if (spinner) {\n        spinner.classList.remove('hidden');\n    }\n    if (description) {\n        description.classList.add('hidden');\n    }\n\n    Ajax.call([{\n        methodname: \"mod_booking_get_booking_option_description\",\n        args: {\n            'optionid': optionid,\n            'userid': userid\n        },\n        done: function(res) {\n\n            let spinner = document.querySelector('#bo_modal_spinner_' + optionid + ' .spinner-border');\n            let description = document.getElementById('bo_modal_description_' + optionid);\n\n            const jsonobject = JSON.parse(res.content);\n\n            Templates.renderForPromise(res.template, jsonobject).then(({html, js}) => {\n\n                Templates.appendNodeContents('#bo_modal_description_' + optionid, html, js);\n\n                spinner.classList.add('hidden');\n                description.classList.remove('hidden');\n\n                return true;\n            }).catch(ex => {\n                Notification.addNotification({\n                    message: 'failed rendering ' + ex,\n                    type: \"danger\"\n                });\n            });\n\n            spinner.classList.add('hidden');\n            description.classList.remove('hidden');\n            return true;\n        },\n        fail: function(err) {\n            // eslint-disable-next-line no-console\n            console.log(err);\n            spinner.classList.add('hidden');\n            description.classList.remove('hidden');\n        }\n    }]);\n};"],"file":"modal_init.min.js"}