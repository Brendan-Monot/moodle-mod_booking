{"version":3,"file":"bookit.min.js","sources":["../src/bookit.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * @module     mod_booking/bookit\r\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport Ajax from 'core/ajax';\r\nimport Templates from 'core/templates';\r\nimport Notification from 'core/notification';\r\n\r\nimport {closeModal, closeInline} from 'mod_booking/bookingpage/prepageFooter';\r\nimport {bookit} from './bookit.1';\r\n\r\nvar currentbookitpage = {};\r\nvar totalbookitpages = {};\r\n\r\nexport var SELECTORS = {\r\n    MODALID: 'sbPrePageModal_',\r\n    INLINEID: 'sbPrePageInline_',\r\n    INMODALDIV: ' div.modalMainContent',\r\n    MODALHEADER: 'div.modalHeader',\r\n    MODALBUTTONAREA: 'div.modalButtonArea',\r\n    MODALFOOTER: 'div.modalFooter',\r\n    CONTINUEBUTTON: 'a.continue-button', // Don't want to find button right now.\r\n    BACKBUTTON: 'a.back-button', // Don't want to find button right now.\r\n    BOOKITBUTTON: 'div.booking-button-area.noprice',\r\n    INMODALBUTTON: 'div.in-modal-button',\r\n    STATICBACKDROP: 'div.modal-backdrop',\r\n};\r\n\r\n/**\r\n * Initializes the bookit button for the normal bookit function.\r\n * @param {integer} itemid\r\n * @param {string} area\r\n */\r\nexport const initbookitbutton = (itemid, area) => {\r\n\r\n    const initselector = SELECTORS.BOOKITBUTTON +\r\n    '[data-itemid]' +\r\n    '[data-area]';\r\n\r\n    if (!itemid || !area) {\r\n        const initbuttons = document.querySelectorAll(initselector);\r\n        initbuttons.forEach(button => {\r\n            const inititemid = button.dataset.itemid;\r\n            const initarea = button.dataset.area;\r\n            initbookitbutton(inititemid, initarea);\r\n        });\r\n        return;\r\n    }\r\n\r\n    const selector = SELECTORS.BOOKITBUTTON +\r\n    '[data-itemid=\"' + itemid + '\"]' +\r\n    '[data-area=\"' + area + '\"]';\r\n\r\n    const buttons = document.querySelectorAll(selector);\r\n\r\n    if (!buttons) {\r\n        return;\r\n    }\r\n\r\n    // We support more than one booking button on the same page.\r\n    buttons.forEach(button => {\r\n\r\n        if (button.dataset.nojs) {\r\n            return;\r\n        }\r\n\r\n        // We don't run code on disabled buttons.\r\n        if (button.classList.contains('disabled')) {\r\n            return;\r\n        }\r\n\r\n        if (!button.dataset.initialized) {\r\n            button.dataset.initialized = 'true';\r\n\r\n            const userid = button.dataset.userid;\r\n\r\n            button.addEventListener('click', (e) => {\r\n\r\n                // E.stopPropagation();\r\n\r\n                const data = button.dataset;\r\n\r\n                if (e.target.classList.contains('shopping-cart-cancel-button')) {\r\n\r\n                    import('local_shopping_cart/shistory')\r\n                    // eslint-disable-next-line promise/always-return\r\n                    .then(shoppingcart => {\r\n                        const confirmCancelModal = shoppingcart.confirmCancelModal;\r\n                        // Now you can use the specific function\r\n                        confirmCancelModal(button, 0);\r\n                    })\r\n                    .catch(err => {\r\n                        // Handle any errors, including if the module doesn't exist\r\n                        // eslint-disable-next-line no-console\r\n                        console.log(err);\r\n                    });\r\n\r\n\r\n                } else if (e.target.classList.contains('btn')) {\r\n                    bookit(itemid, area, userid, data);\r\n                }\r\n            });\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * Gets called from mustache template.\r\n * @param {integer} optionid\r\n * @param {integer} userid\r\n * @param {integer} totalnumberofpages\r\n * @param {string} uniquid\r\n */\r\nexport const initprepagemodal = (optionid, userid, totalnumberofpages, uniquid) => {\r\n\r\n    // eslint-disable-next-line no-console\r\n    console.log('initprepagemodal', optionid, userid, totalnumberofpages, uniquid);\r\n\r\n    if (!optionid || !uniquid || !totalnumberofpages) {\r\n\r\n        const elements = document.querySelectorAll(\"[id^=\" + SELECTORS.MODALID);\r\n\r\n        elements.forEach(element => {\r\n\r\n            optionid = element.dataset.optionid;\r\n            uniquid = element.dataset.uniquid;\r\n            userid = element.dataset.userid;\r\n            totalnumberofpages = element.dataset.pages;\r\n            if (optionid && uniquid) {\r\n                initprepagemodal(optionid, userid, totalnumberofpages, uniquid);\r\n            }\r\n        });\r\n        return;\r\n    }\r\n\r\n    currentbookitpage[optionid] = 0;\r\n    totalbookitpages[optionid] = totalnumberofpages;\r\n\r\n    // We need to get all prepage modals on this site. Make sure they are initialized.\r\n    respondToVisibility(optionid, userid, uniquid, totalnumberofpages, loadPreBookingPage);\r\n};\r\n\r\n/**\r\n * Gets called from mustache template.\r\n * @param {integer} optionid\r\n * @param {integer} userid\r\n * @param {integer} totalnumberofpages\r\n * @param {string} uniquid\r\n */\r\nexport const initprepageinline = (optionid, userid, totalnumberofpages, uniquid) => {\r\n\r\n    // eslint-disable-next-line no-console\r\n    console.log('initprepageinline', optionid, userid, totalnumberofpages, uniquid);\r\n\r\n    if (!optionid || !uniquid || !totalnumberofpages) {\r\n\r\n        const elements = document.querySelectorAll(\"[id^=\" + SELECTORS.INLINEID);\r\n\r\n        // eslint-disable-next-line no-console\r\n        console.log(elements);\r\n\r\n        elements.forEach(element => {\r\n            optionid = element.dataset.optionid;\r\n            uniquid = element.dataset.uniquid;\r\n            userid = element.dataset.userid;\r\n            totalnumberofpages = element.dataset.pages;\r\n            if (optionid && uniquid) {\r\n                initprepageinline(optionid, userid, totalnumberofpages, uniquid);\r\n            }\r\n        });\r\n        return;\r\n    }\r\n\r\n    currentbookitpage[optionid] = 0;\r\n    totalbookitpages[optionid] = totalnumberofpages;\r\n\r\n    // Retrieve the right button.\r\n    const buttons = document.querySelectorAll(\r\n        '[data-itemid=\"' + optionid + '\"]' +\r\n        '[data-area=\"option\"]'\r\n    );\r\n\r\n    // Add the click listener to the button.\r\n\r\n    buttons.forEach(button => {\r\n\r\n        if (button.dataset.initialized) {\r\n            return;\r\n        }\r\n\r\n        button.dataset.initialized = true;\r\n\r\n        // eslint-disable-next-line no-console\r\n        console.log('add listener to button', button, button.dataset.action);\r\n\r\n        button.addEventListener('click', e => {\r\n\r\n            // Get the row element.\r\n            let rowcontainer = e.target.closest('.row');\r\n\r\n            const transferarea = !rowcontainer.lastElementChild.classList.contains('inlineprepagearea');\r\n            // We move the inlineprepagearea only if we need to.\r\n            if (transferarea) {\r\n                let inlinediv = returnVisibleElement(optionid, uniquid, SELECTORS.INMODALDIV);\r\n\r\n                rowcontainer.append(inlinediv.closest('.inlineprepagearea'));\r\n                // Inlinediv.remove();\r\n\r\n                // We need to get all prepage modals on this site. Make sure they are initialized.\r\n                loadPreBookingPage(optionid, userid, uniquid);\r\n            }\r\n        });\r\n    });\r\n};\r\n\r\n/**\r\n * React on visibility change.\r\n * @param {integer} optionid\r\n * @param {integer} userid\r\n * @param {string} uniquid\r\n * @param {integer} totalnumberofpages\r\n * @param {function} callback\r\n */\r\nfunction respondToVisibility(optionid, userid, uniquid, totalnumberofpages, callback) {\r\n\r\n    let elements = document.querySelectorAll(\"[id^=\" + SELECTORS.MODALID + optionid + \"_\" + uniquid + \"]\");\r\n\r\n    elements.forEach(element => {\r\n\r\n        if (!element || element.dataset.initialized == 'true') {\r\n            return;\r\n        }\r\n\r\n        element.dataset.initialized = true;\r\n\r\n        var observer = new MutationObserver(function() {\r\n\r\n            if (!isHidden(element)) {\r\n\r\n                // Because of the modal animation, \"isHIdden\" is also true on hiding modal.\r\n                if (element.classList.contains('show')) {\r\n\r\n                    // Todo: Make sure it's not triggered on close.\r\n                    callback(optionid, userid, uniquid, totalnumberofpages);\r\n                }\r\n            }\r\n        });\r\n\r\n        // We look if we find a hidden parent. If not, we load right away.\r\n        while (element !== null) {\r\n            if (!isHidden(element)) {\r\n                element = element.parentElement;\r\n            } else {\r\n                if (element.dataset.observed) {\r\n                    return;\r\n                }\r\n\r\n                observer.observe(element, {attributes: true});\r\n                element.dataset.observed = true;\r\n                return;\r\n            }\r\n        }\r\n        callback(optionid, userid, uniquid, totalnumberofpages);\r\n    });\r\n}\r\n\r\n/**\r\n * Function to check visibility of element.\r\n * @param {*} el\r\n * @returns {boolean}\r\n */\r\nfunction isHidden(el) {\r\n    var style = window.getComputedStyle(el);\r\n    return ((style.display === 'none') || (style.visibility === 'hidden'));\r\n}\r\n\r\n/**\r\n * Loads the (next) pre booking page.\r\n * @param {integer} optionid\r\n * @param {integer} userid\r\n * @param {string} uniquid\r\n */\r\nexport const loadPreBookingPage = (\r\n    optionid, userid = 0, uniquid = '') => {\r\n\r\n    const element = returnVisibleElement(optionid, uniquid, SELECTORS.INMODALDIV);\r\n\r\n    if (element) {\r\n        while (element.firstChild) {\r\n            element.removeChild(element.firstChild);\r\n        }\r\n    } else {\r\n        // eslint-disable-next-line no-console\r\n        console.error('didnt find element');\r\n    }\r\n\r\n    Ajax.call([{\r\n        methodname: \"mod_booking_allow_add_item_to_cart\",\r\n        args: {\r\n            'itemid': optionid,\r\n            'userid': userid,\r\n        },\r\n        done: function(response) {\r\n            // Will always be 1, if shopping cart is not installed!\r\n            if (response.success == 1) {\r\n                Ajax.call([{\r\n                    methodname: \"mod_booking_load_pre_booking_page\",\r\n                    args: {\r\n                        optionid,\r\n                        userid,\r\n                        'pagenumber': currentbookitpage[optionid],\r\n                    },\r\n                    done: function(res) {\r\n                        // If we are on the last page, we reset it to 0.\r\n                        if (currentbookitpage[optionid] === totalbookitpages[optionid] - 1) {\r\n                            currentbookitpage[optionid] = 0;\r\n                        }\r\n\r\n                        const jsonobject = JSON.parse(res.json);\r\n\r\n                        // We support more than one template, they will be seperated by comma.\r\n                        // We have a data key in the json\r\n                        const templates = res.template.split(',');\r\n                        let dataarray = jsonobject;\r\n                        // Const buttontype = res.buttontype;\r\n\r\n                        renderTemplatesOnPage(templates, dataarray, element);\r\n                    },\r\n                    fail: function(err) {\r\n                        // eslint-disable-next-line no-console\r\n                        console.log(err);\r\n                    }\r\n                }]);\r\n            } else {\r\n\r\n                closeModal(optionid, false);\r\n                closeInline(optionid, false);\r\n\r\n                // Make sure that the prepage modal is actually closed.\r\n\r\n                import('local_shopping_cart/cart')\r\n                    // eslint-disable-next-line promise/always-return\r\n                    .then(shoppingcart => {\r\n                        const addItemShowNotification = shoppingcart.addItemShowNotification;\r\n                        // Now you can use the specific function\r\n                        response.userid = userid;\r\n                        addItemShowNotification(response);\r\n                    })\r\n                    .catch(err => {\r\n                        // Handle any errors, including if the module doesn't exist\r\n                        // eslint-disable-next-line no-console\r\n                        console.log(err);\r\n                });\r\n            }\r\n\r\n            return true;\r\n        },\r\n        fail: function(err) {\r\n            // eslint-disable-next-line no-console\r\n            console.log(err);\r\n        }\r\n    }]);\r\n};\r\n\r\n/**\r\n *\r\n * @param {string} templates\r\n * @param {object} dataarray\r\n * @param {HTMLElement} element\r\n */\r\nasync function renderTemplatesOnPage(templates, dataarray, element) {\r\n\r\n    const modal = element.closest('.prepage-body');\r\n\r\n    // We need to pass the id of our element to the templates to render.\r\n    // If not, we might select the wrong modal or collapsible.\r\n    let elementid = modal.id;\r\n\r\n    if (!elementid) {\r\n        const parent = modal.closest('[id]');\r\n        elementid = parent.id;\r\n    }\r\n\r\n    // eslint-disable-next-line no-console\r\n    console.log(modal, elementid);\r\n\r\n    modal.querySelector(SELECTORS.MODALHEADER).innerHTML = '';\r\n    modal.querySelector(SELECTORS.INMODALDIV).innerHTML = '';\r\n    modal.querySelector(SELECTORS.MODALBUTTONAREA).innerHTML = '';\r\n    modal.querySelector(SELECTORS.MODALFOOTER).innerHTML = '';\r\n\r\n    templates.forEach(async template => {\r\n\r\n        const data = dataarray.shift();\r\n\r\n        let targetelement = element;\r\n\r\n        if (!data) {\r\n            return true;\r\n        }\r\n\r\n        data.data.elementid = elementid;\r\n\r\n        switch (template) {\r\n            case 'mod_booking/bookingpage/header':\r\n                targetelement = modal.querySelector(SELECTORS.MODALHEADER);\r\n                break;\r\n            case 'mod_booking/bookit_button':\r\n            case 'mod_booking/bookit_price':\r\n                targetelement = modal.querySelector(SELECTORS.MODALBUTTONAREA);\r\n                break;\r\n            case 'mod_booking/bookingpage/footer':\r\n                targetelement = modal.querySelector(SELECTORS.MODALFOOTER);\r\n                break;\r\n            default:\r\n                targetelement = modal.querySelector(SELECTORS.INMODALDIV);\r\n                break;\r\n        }\r\n\r\n        // eslint-disable-next-line no-console\r\n        console.log(data.data);\r\n\r\n        await Templates.renderForPromise(template, data.data).then(({html, js}) => {\r\n\r\n            Templates.replaceNodeContents(targetelement, html, js);\r\n\r\n            return true;\r\n        }).catch(ex => {\r\n            Notification.addNotification({\r\n                message: 'failed rendering ' + JSON.stringify(ex),\r\n                type: \"danger\"\r\n            });\r\n        });\r\n        return true;\r\n    });\r\n    return true;\r\n}\r\n\r\n/**\r\n * We want to find out the visible modal\r\n * @param {integer} optionid\r\n * @param {string} uniquid\r\n * @param {string} appendedSelector\r\n * @returns {HTMLElement}\r\n */\r\nfunction returnVisibleElement(optionid, uniquid, appendedSelector) {\r\n\r\n    // First, we get all the possbile Elements (we don't now the unique id appended to the element.)\r\n    let selector = '[id^=\"' + SELECTORS.MODALID + optionid + '_' + uniquid + '\"] ' + appendedSelector;\r\n    if (!uniquid || uniquid.length === 0) {\r\n        selector = '[id^=\"' + SELECTORS.MODALID + optionid + '_\"].show ' + appendedSelector;\r\n    }\r\n\r\n    let elements = document.querySelectorAll(selector);\r\n\r\n    // If the nodelist is empty, we we mgiht use inline.\r\n    // If so, we need to have a different way of selecting elements.\r\n    if (elements.length === 0) {\r\n\r\n        selector = '[id^=\"' + SELECTORS.INLINEID + optionid + '_\"] ' + appendedSelector;\r\n        elements = document.querySelectorAll(selector);\r\n\r\n    }\r\n\r\n    let visibleElement = null;\r\n\r\n    elements.forEach(element => {\r\n\r\n        var elementtocheck = element.parentElement.parentElement;\r\n\r\n        // We look if we find a hidden parent. If not, we load right away.\r\n        while (elementtocheck !== null) {\r\n            if (!isHidden(elementtocheck)) {\r\n                elementtocheck = elementtocheck.parentElement;\r\n\r\n            } else {\r\n\r\n                break;\r\n            }\r\n        }\r\n        // If after the while, we have still an element, it's hidden.\r\n        // So we only apply visible if it's null.\r\n        if (!elementtocheck) {\r\n            visibleElement = element;\r\n        }\r\n    });\r\n\r\n    return visibleElement;\r\n}\r\n\r\n/**\r\n * Load next prepage booking page.\r\n * @param {int} optionid\r\n * @param {int} userid\r\n */\r\nexport function continueToNextPage(optionid, userid) {\r\n    if (currentbookitpage[optionid] < totalbookitpages[optionid]) {\r\n        currentbookitpage[optionid]++;\r\n        loadPreBookingPage(optionid, userid);\r\n    }\r\n}\r\n\r\n/**\r\n *  Load previous prepage booking page.\r\n * @param {int} optionid\r\n * @param {int} userid\r\n */\r\nexport function backToPreviousPage(optionid, userid) {\r\n\r\n    currentbookitpage[optionid]--;\r\n\r\n    loadPreBookingPage(optionid, userid);\r\n}\r\n\r\n/**\r\n *  Set back variables used in modal.\r\n *  @param {int} optionid\r\n */\r\nexport function setBackModalVariables(optionid) {\r\n\r\n    currentbookitpage[optionid] = 0;\r\n}\r\n"],"names":["optionid","userid","currentbookitpage","loadPreBookingPage","totalbookitpages","_ajax","_interopRequireDefault","_templates","_notification","_systemImportTransformerGlobalIdentifier","window","self","global","obj","__esModule","default","SELECTORS","_exports","MODALID","INLINEID","INMODALDIV","MODALHEADER","MODALBUTTONAREA","MODALFOOTER","CONTINUEBUTTON","BACKBUTTON","BOOKITBUTTON","INMODALBUTTON","STATICBACKDROP","initbookitbutton","itemid","area","initselector","document","querySelectorAll","forEach","button","inititemid","dataset","initarea","selector","buttons","nojs","classList","contains","initialized","addEventListener","e","data","target","define","amd","Promise","resolve","reject","require","module","exports","component","loader","then","shoppingcart","confirmCancelModal","catch","err","console","log","bookit","initprepagemodal","totalnumberofpages","uniquid","callback","elements","element","observer","MutationObserver","isHidden","observed","observe","attributes","parentElement","respondToVisibility","pages","initprepageinline","action","rowcontainer","closest","lastElementChild","inlinediv","returnVisibleElement","append","el","style","getComputedStyle","display","visibility","arguments","length","undefined","firstChild","removeChild","error","Ajax","call","methodname","args","done","response","success","pagenumber","res","jsonobject","JSON","parse","json","async","templates","dataarray","modal","elementid","id","parent","querySelector","innerHTML","shift","targetelement","template","Templates","renderForPromise","_ref","html","js","replaceNodeContents","ex","Notification","addNotification","message","stringify","type","renderTemplatesOnPage","split","fail","closeModal","closeInline","addItemShowNotification","appendedSelector","visibleElement","elementtocheck"],"mappings":"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"}