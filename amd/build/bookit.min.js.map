{"version":3,"file":"bookit.min.js","sources":["../src/bookit.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     mod_booking/bookit\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\n\nimport {reloadAllTables} from 'local_wunderbyte_table/reload';\n\nvar currentbookitpage = {};\nvar totalbookitpages = {};\n\nvar SELECTORS = {\n    MODALID: 'sbPrePageModal_',\n    INMODALDIV: ' div.modalMainContent',\n    MODALHEADER: 'div.modalHeader',\n    MODALBUTTONAREA: 'div.modalButtonArea',\n    MODALFOOTER: 'div.modalFooter',\n    CONTINUEBUTTON: 'a.continue-button', // Don't want to find button right now.\n    BACKBUTTON: 'a.back-button', // Don't want to find button right now.\n    BOOKITBUTTON: 'div.booking-button-area.noprice',\n    INMODALBUTTON: 'div.in-modal-button',\n    STATICBACKDROP: 'div.modal-backdrop',\n};\n\n/**\n * Initializes the bookit button for the normal bookit function.\n * @param {integer} itemid\n * @param {string} area\n */\nexport const initbookitbutton = (itemid, area) => {\n\n    const initselector = SELECTORS.BOOKITBUTTON +\n    '[data-itemid]' +\n    '[data-area]';\n\n    if (!itemid || !area) {\n        const initbuttons = document.querySelectorAll(initselector);\n        initbuttons.forEach(button => {\n            const inititemid = button.dataset.itemid;\n            const initarea = button.dataset.area;\n            initbookitbutton(inititemid, initarea);\n        });\n        return;\n    }\n\n    const selector = SELECTORS.BOOKITBUTTON +\n    '[data-itemid=\"' + itemid + '\"]' +\n    '[data-area=\"' + area + '\"]';\n\n    const buttons = document.querySelectorAll(selector);\n\n    if (!buttons) {\n        return;\n    }\n\n    // We support more than one booking button on the same page.\n    buttons.forEach(button => {\n\n        if (button.dataset.nojs) {\n            return;\n        }\n\n        // We don't run code on disabled buttons.\n        if (button.classList.contains('disabled')) {\n            return;\n        }\n\n        if (!button.dataset.initialized) {\n            button.dataset.initialized = 'true';\n\n            const userid = button.dataset.userid;\n\n            button.addEventListener('click', (e) => {\n\n                // E.stopPropagation();\n\n                const data = button.dataset;\n\n                if (e.target.classList.contains('btn')) {\n                    bookit(itemid, area, userid, data);\n                }\n            });\n        }\n    });\n};\n\n/**\n * Gets called from mustache template.\n * @param {integer} optionid\n * @param {integer} userid\n * @param {integer} totalnumberofpages\n * @param {string} uniquid\n */\nexport const initprepagemodal = (optionid, userid, totalnumberofpages, uniquid) => {\n\n    // eslint-disable-next-line no-console\n    console.log('initprepagemodal', optionid, userid, totalnumberofpages, uniquid);\n\n    if (!optionid || !uniquid || !totalnumberofpages) {\n\n        const elements = document.querySelectorAll(\"[id^=\" + SELECTORS.MODALID);\n\n        elements.forEach(element => {\n            optionid = element.dataset.optionid;\n            uniquid = element.dataset.uniquid;\n            userid = element.dataset.userid;\n            totalnumberofpages = element.dataset.pages;\n            if (optionid && uniquid) {\n                initprepagemodal(optionid, userid, totalnumberofpages, uniquid);\n            }\n        });\n        return;\n    }\n\n    currentbookitpage[optionid] = 0;\n    totalbookitpages[optionid] = totalnumberofpages;\n\n    // We need to get all prepage modals on this site. Make sure they are initialized.\n\n    respondToVisibility(optionid, userid, uniquid, totalnumberofpages, loadPreBookingPage);\n};\n\n/**\n * React on visibility change.\n * @param {integer} optionid\n * @param {integer} userid\n * @param {string} uniquid\n * @param {integer} totalnumberofpages\n * @param {function} callback\n */\nfunction respondToVisibility(optionid, userid, uniquid, totalnumberofpages, callback) {\n\n    // eslint-disable-next-line no-console\n    console.log('respondToVisibility', optionid, totalnumberofpages, uniquid);\n\n    let elements = document.querySelectorAll(\"[id^=\" + SELECTORS.MODALID + optionid + \"_\" + uniquid + \"]\");\n\n    // eslint-disable-next-line no-console\n    console.log('elements', \"[id^=\" + SELECTORS.MODALID + optionid + \"_\" + uniquid + \"]\", elements);\n\n    elements.forEach(element => {\n        if (!element || element.dataset.initialized == 'true') {\n            return;\n        }\n\n        element.dataset.initialized = true;\n\n        var observer = new MutationObserver(function() {\n            if (!isHidden(element)) {\n                // Todo: Make sure it's not triggered on close.\n                callback(optionid, userid, uniquid, totalnumberofpages);\n            }\n        });\n\n        // We look if we find a hidden parent. If not, we load right away.\n        while (element !== null) {\n            if (!isHidden(element)) {\n                element = element.parentElement;\n            } else {\n                if (element.dataset.observed) {\n                    return;\n                }\n\n                observer.observe(element, {attributes: true});\n                element.dataset.observed = true;\n                return;\n            }\n        }\n        callback(optionid, userid, uniquid, totalnumberofpages);\n    });\n}\n\n/**\n * Function to check visibility of element.\n * @param {*} el\n * @returns {boolean}\n */\nfunction isHidden(el) {\n    var style = window.getComputedStyle(el);\n    return ((style.display === 'none') || (style.visibility === 'hidden'));\n}\n\n/**\n * Loads the (next) pre booking page.\n * @param {integer} optionid\n * @param {integer} userid\n * @param {string} uniquid\n */\nexport const loadPreBookingPage = (\n    optionid, userid = 0, uniquid = '') => {\n\n    // eslint-disable-next-line no-console\n    console.log('loadPreBookingPage', optionid, uniquid, userid);\n\n    const element = returnVisibleElement(optionid, uniquid, SELECTORS.INMODALDIV);\n    if (element) {\n        while (element.firstChild) {\n            element.removeChild(element.firstChild);\n        }\n    } else {\n        // eslint-disable-next-line no-console\n        console.error('didnt find element');\n    }\n\n    Ajax.call([{\n        methodname: \"mod_booking_load_pre_booking_page\",\n        args: {\n            optionid,\n            userid,\n            'pagenumber': currentbookitpage[optionid],\n        },\n        done: function(res) {\n\n            // eslint-disable-next-line no-console\n            console.log(currentbookitpage[optionid], totalbookitpages[optionid]);\n\n            // If we are on the last page, we reset it to 0.\n            if (currentbookitpage[optionid] === totalbookitpages[optionid] - 1) {\n                currentbookitpage[optionid] = 0;\n            }\n\n            const jsonobject = JSON.parse(res.json);\n\n            // We support more than one template, they will be seperated by comma.\n            // We have a data key in the json\n            const templates = res.template.split(',');\n            let dataarray = jsonobject;\n            // Const buttontype = res.buttontype;\n\n            renderTemplatesOnPage(templates, dataarray, element);\n\n            // ShowRightButton(optionid, buttontype);\n\n            return true;\n        },\n        fail: function(err) {\n            // eslint-disable-next-line no-console\n            console.log(err);\n        }\n    }]);\n};\n\n/**\n *\n * @param {string} templates\n * @param {object} dataarray\n * @param {HTMLElement} element\n */\nasync function renderTemplatesOnPage(templates, dataarray, element) {\n\n    // eslint-disable-next-line no-console\n    console.log('templates: ', templates);\n\n    const modal = element.closest('.modal-body');\n\n    modal.querySelector(SELECTORS.MODALHEADER).innerHTML = '';\n    modal.querySelector(SELECTORS.INMODALDIV).innerHTML = '';\n    modal.querySelector(SELECTORS.MODALBUTTONAREA).innerHTML = '';\n    modal.querySelector(SELECTORS.MODALFOOTER).innerHTML = '';\n\n    templates.forEach(async template => {\n\n        const data = dataarray.shift();\n\n        // eslint-disable-next-line no-console\n        console.log('data: ', data);\n\n        let targetelement = element;\n\n        if (!data) {\n            return true;\n        }\n\n        switch (template) {\n            case 'mod_booking/bookingpage/header':\n                targetelement = modal.querySelector(SELECTORS.MODALHEADER);\n                break;\n            case 'mod_booking/bookit_button':\n            case 'mod_booking/bookit_price':\n                targetelement = modal.querySelector(SELECTORS.MODALBUTTONAREA);\n                break;\n            case 'mod_booking/bookingpage/footer':\n                targetelement = modal.querySelector(SELECTORS.MODALFOOTER);\n                break;\n            default:\n                targetelement = modal.querySelector(SELECTORS.INMODALDIV);\n                break;\n        }\n\n        // eslint-disable-next-line no-console\n        console.log('data.data: ', data.data);\n\n        await Templates.renderForPromise(template, data.data).then(({html, js}) => {\n\n            // eslint-disable-next-line no-console\n            console.log('targetelement: ', targetelement);\n\n            Templates.replaceNodeContents(targetelement, html, js);\n\n            return true;\n        }).catch(ex => {\n            Notification.addNotification({\n                message: 'failed rendering ' + ex,\n                type: \"danger\"\n            });\n        });\n        return true;\n    });\n    return true;\n}\n\n/**\n *\n * @param {int} itemid\n * @param {string} area\n * @param {int} userid\n * @param {object} data\n */\nfunction bookit(itemid, area, userid, data) {\n\n    Ajax.call([{\n        methodname: \"mod_booking_bookit\",\n        args: {\n            'itemid': itemid,\n            'area': area,\n            'userid': userid,\n            'data': JSON.stringify(data),\n        },\n        done: function(res) {\n\n            if (document.querySelector('.booking-elective-component')) {\n                window.location.reload();\n            }\n\n            const jsonarray = JSON.parse(res.json);\n\n            // We might have more than one template to render.\n            const templates = res.template.split(',');\n\n            // There might be more than one button area.\n            const buttons = document.querySelectorAll(SELECTORS.BOOKITBUTTON +\n                '[data-itemid=\\'' + itemid + '\\']' +\n                '[data-area=\\'' + area + '\\']');\n\n            const promises = [];\n\n            // eslint-disable-next-line no-console\n            console.log('buttons:', buttons);\n\n            // We run through every button. and render the data.\n            buttons.forEach(button => {\n\n                // For every button, we need a new jsonarray.\n                const arraytoreduce = [...jsonarray];\n\n                templates.forEach(template => {\n\n                    const data = arraytoreduce.shift();\n\n                    // eslint-disable-next-line no-console\n                    console.log('data (arraytoreduce): ', data);\n\n                    // We need to check if this will render the prepagemodal again.\n                    // We never render the prepage modal in the in modal button.\n                    if (!(template === 'mod_booking/bookingpage/prepagemodal'\n                            && button.parentElement.classList.contains('in-modal-button'))) {\n\n                        const datatorender = data.data ?? data;\n\n                        const promise = Templates.renderForPromise(template, datatorender).then(({html, js}) => {\n\n                            Templates.replaceNode(button, html, js);\n\n                            return true;\n                        }).catch(ex => {\n                            Notification.addNotification({\n                                message: 'failed rendering ' + ex,\n                                type: \"danger\"\n                            });\n                        });\n\n                        promises.push(promise);\n                    }\n                });\n            });\n\n            Promise.all(promises).then(() => {\n\n                const backdrop = document.querySelector(SELECTORS.STATICBACKDROP);\n\n                if (!backdrop) {\n                    reloadAllTables();\n                }\n\n                // The actions on successful booking are executed elsewhere.\n                return true;\n            }).catch(e => {\n                // eslint-disable-next-line no-console\n                console.log(e);\n            });\n        }\n    }]);\n}\n\n/**\n * We want to find out the visible modal\n * @param {integer} optionid\n * @param {string} uniquid\n * @param {string} appendedSelector\n * @returns {HTMLElement}\n */\nfunction returnVisibleElement(optionid, uniquid, appendedSelector) {\n\n    // First, we get all the possbile Elements (we don't now the unique id appended to the element.)\n    let selector = \"[id^=\" + SELECTORS.MODALID + optionid + \"_\" + uniquid + \"] \" + appendedSelector;\n    if (!uniquid || uniquid.length === 0) {\n        selector = \"[id^=\" + SELECTORS.MODALID + optionid + \"].show \" + appendedSelector;\n    }\n\n    const elements = document.querySelectorAll(selector);\n\n    let visibleElement = null;\n\n    elements.forEach(element => {\n\n        // eslint-disable-next-line no-console\n        console.log('visibleElement', selector, element);\n\n        visibleElement = element;\n    });\n\n    return visibleElement;\n}\n\n/**\n * Load next prepage booking page.\n * @param {int} optionid\n * @param {int} userid\n */\nexport function continueToNextPage(optionid, userid) {\n    if (currentbookitpage[optionid] < totalbookitpages[optionid]) {\n        currentbookitpage[optionid]++;\n        loadPreBookingPage(optionid, userid);\n    }\n}\n\n/**\n *  Load previous prepage booking page.\n * @param {int} optionid\n * @param {int} userid\n */\nexport function backToPreviousPage(optionid, userid) {\n\n    currentbookitpage[optionid]--;\n\n    loadPreBookingPage(optionid, userid);\n}\n\n/**\n *  Set back variables used in modal.\n *  @param {int} optionid\n */\nexport function setBackModalVariables(optionid) {\n    // eslint-disable-next-line no-console\n    console.log('setBackModalVariables - optionid: ' + optionid + ' currentbookitpage[optionid]: ' + currentbookitpage[optionid]);\n    currentbookitpage[optionid] = 0;\n}"],"names":["_interopRequireDefault","obj","__esModule","default","optionid","userid","currentbookitpage","loadPreBookingPage","totalbookitpages","console","log","_ajax","_templates","_notification","SELECTORS","initbookitbutton","itemid","area","initselector","document","querySelectorAll","forEach","button","inititemid","dataset","initarea","selector","buttons","nojs","classList","contains","initialized","addEventListener","e","data","target","Ajax","call","methodname","args","JSON","stringify","done","res","querySelector","window","location","reload","jsonarray","parse","json","templates","template","split","promises","arraytoreduce","shift","parentElement","_data$data","datatorender","promise","Templates","renderForPromise","then","_ref2","html","js","replaceNode","catch","ex","Notification","addNotification","message","type","push","Promise","all","reloadAllTables","bookit","_exports","initprepagemodal","totalnumberofpages","uniquid","callback","elements","element","observer","MutationObserver","isHidden","observed","observe","attributes","respondToVisibility","pages","el","style","getComputedStyle","display","visibility","arguments","length","undefined","appendedSelector","visibleElement","returnVisibleElement","firstChild","removeChild","error","pagenumber","jsonobject","async","dataarray","modal","closest","innerHTML","targetelement","_ref","replaceNodeContents","renderTemplatesOnPage","fail","err"],"mappings":"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"}